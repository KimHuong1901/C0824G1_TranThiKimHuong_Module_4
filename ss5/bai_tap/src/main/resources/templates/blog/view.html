<script>
    let currentPage = 0;

    // Hàm gọi API và hiển thị danh sách blog
    function searchBlogs(name, page = 0) {
        if (!name.trim()) {
            name = "";
        }

        $.ajax({
            url: "http://localhost:8080/api/blog/search_category",
            type: "GET",
            data: {
                categoryName: name,
                page: page
            },
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            success: function (data) {
                console.log(data);
                const tableBody = document.getElementById("table").getElementsByTagName("tbody")[0];
                if (page === 0) {
                    tableBody.innerHTML = "";
                }
                if (data.content && data.content.length > 0) {
                    data.content.forEach((item, index) => {
                        const row = document.createElement("tr");
                        row.innerHTML = `
                            <td>${index + 1 + page * data.size}</td>
                            <td>${item.id}</td>
                            <td>${item.title}</td>
                            <td>${item.author}</td>
                            <td>${item.time}</td>
                            <td><button class="btn btn-danger btn-sm">Delete</button></td>
                        `;
                        tableBody.appendChild(row);
                    });
                    if (data.last) {
                        document.getElementById("moreButton").style.display = "none";
                    } else {
                        document.getElementById("moreButton").style.display = "inline-block";
                    }
                } else {
                    tableBody.innerHTML = "<tr><td colspan='6'>No blogs found.</td></tr>";
                }
            },
            error: function (xhr, status, error) {
                console.error("Error fetching data:", xhr.status, xhr.responseText);
                alert("Failed to fetch data. Error: " + xhr.status + " " + error);
            }
        });
    }
    document.getElementById("searchButton").addEventListener("click", function () {
        const categoryName = document.getElementById("categoryName").value.trim();
        if (!categoryName) {
            alert("Please enter a category name or leave it blank to show all blogs.");
            currentPage = 0;
            searchBlogs("", currentPage);
        } else {
            currentPage = 0;
            searchBlogs(categoryName, currentPage);
        }
    });
    document.getElementById("moreButton").addEventListener("click", function () {
        const categoryName = document.getElementById("categoryName").value.trim();
        currentPage++;
        searchBlogs(categoryName, currentPage);
    });
    searchBlogs("", currentPage);
</script>
